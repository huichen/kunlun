性能评测
======


对比了 [Google 的 zoekt 引擎](https://github.com/google/zoekt)，这款引擎在其他开源代码搜索引擎中无论是功能完整性还是性能都相对较好。

数据：
1.  小数据集：一个约 60 万行的代码仓库
2.  大数据集：600+仓库，约 2000 万行代码，都做分页取前 1000 个结果

方法：
1.  昆仑：使用 [评测代码 cmd/benchmark/main.go](/cmd/benchmark/main.go)，-runs=100 执行 100 次取平均
2.  zoekt：使用 zoekt-webserver，maxresults=10000，读取 footer 中的延迟，5 次取平均
3.  分别测试了单串和正则两个类型的表达式

#### 搜索速度

**小数据集**

```
搜索 "kafka"：
昆仑：0.920 ms
zoekt：3.654 ms

搜索 "cpu.*cache"：
昆仑：0.347 ms
zoekt：29.712 ms

搜索 "gc.*time"：
昆仑：1.265 ms
zoekt：365.794 ms
```

**大数据集**

```
搜索 "kafka"：
昆仑：1.208 ms
zoekt：13.595 ms

搜索 "cpu.*cache"
昆仑：4.222 ms
zoekt：45.980 ms

搜索 "gc.*time"
昆仑：41.275 ms
zoekt：4628 ms
```

#### 结论

由于采用了[多种优化手段](/doc/regexp.md)，相比竞品，昆仑对正则表达式的搜索速度提升在 10 倍以上，对于极端情况比如 "gc.*time" 提升可以在 100 倍左右。

对于简单字符串匹配，随之数据集的扩张（从 60 万到 2000 万行代码），昆仑的性能下降速度远低于数据集膨胀速度（从 0.920 毫秒 到 1.208 毫秒）。